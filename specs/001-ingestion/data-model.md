# Data Model: Book Content Ingestion Module

## Overview
Data model for the ingestion module that processes book content and stores vector embeddings in Qdrant for chatbot integration.

## Entity Definitions

### Embedding Record
**Description**: Represents a vector embedding of book content with associated metadata

**Fields**:
- `id` (string, UUID): Unique identifier for the embedding record
- `vector` (array of floats): The vector embedding generated by Cohere API
- `text` (string): The original text content that was embedded
- `module` (string): The module identifier (e.g., "module1", "module2")
- `chapter` (string): The chapter identifier (e.g., "chapter1", "chapter2")
- `chunk_index` (integer, optional): Index of this chunk if the original text was split
- `created_at` (timestamp): When this record was created
- `source_file` (string): Path to the original source file

**Validation Rules**:
- `id` must be a valid UUID
- `vector` must have consistent dimensions (expected 1024 for embed-english-v3.0)
- `text` must not be empty
- `module` and `chapter` must not be empty
- `chunk_index` must be >= 0 if present

### Configuration
**Description**: Runtime configuration for the ingestion process

**Fields**:
- `qdrant_url` (string): URL for the Qdrant database connection
- `qdrant_api_key` (string, optional): API key for Qdrant authentication
- `cohere_api_key` (string): API key for Cohere API access
- `frontend_docs_path` (string): Path to the frontend documentation directory
- `collection_name` (string): Name of the Qdrant collection to use
- `chunk_size` (integer): Maximum size of text chunks in tokens
- `batch_size` (integer): Number of embeddings to process in each batch
- `retry_attempts` (integer): Number of retry attempts for API calls

**Validation Rules**:
- All required fields must be present
- URLs must be valid
- API keys must not be empty
- Paths must exist and be readable
- Numeric values must be positive

### Processing Status
**Description**: Tracks the progress and status of the ingestion process

**Fields**:
- `module` (string): The module being processed
- `chapter` (string): The chapter being processed
- `status` (enum): Processing status (pending, processing, completed, failed)
- `progress` (float): Progress percentage (0.0 to 1.0)
- `message` (string, optional): Additional status information
- `timestamp` (timestamp): When this status was recorded

**Validation Rules**:
- `status` must be one of the allowed values
- `progress` must be between 0.0 and 1.0

## Relationships

### Embedding Record Relationships
- Each Embedding Record belongs to exactly one module and one chapter
- Multiple Embedding Records can belong to the same module and chapter (when text is chunked)

### Configuration Relationships
- Configuration is a singleton that affects the entire ingestion process

### Processing Status Relationships
- Processing Status tracks the ingestion of each chapter within each module
- Each module-chapter combination has at most one Processing Status record at any time

## State Transitions (if applicable)

### Processing Status State Transitions
- `pending` → `processing`: When ingestion of a chapter begins
- `processing` → `completed`: When all chunks of a chapter are successfully processed
- `processing` → `failed`: When ingestion encounters an unrecoverable error
- `failed` → `processing`: When retrying a failed chapter (if retry is configured)

## Constraints

### Data Integrity
- Each embedding record must have a unique UUID
- The combination of module, chapter, and chunk_index must be unique within the database
- Text content should not exceed API limits before embedding generation

### Performance
- Embedding vectors should maintain consistent dimensionality for similarity search
- Metadata should be indexed for efficient filtering and retrieval